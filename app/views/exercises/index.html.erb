<% content_for :title, "Exercises" %>

<div class="w-full">

  <div class="flex justify-between items-center">
    <h1 class="font-bold text-4xl">Exercises</h1>
    <% if user_signed_in? %>
      <%= link_to "New exercise", new_exercise_path, class: "rounded-lg px-4 py-2 bg-green-500 hover:bg-green-600 text-white font-semibold shadow-sm transition cursor-pointer" %>
    <% end %>
  </div>

  <!-- ---------------- Filters ---------------- -->
  <div class="mt-6 flex flex-col gap-4 sm:flex-row sm:items-center sm:justify-between">
    <%# Tabs: All / System / Mine %>
    <% if user_signed_in? %>
      <%= render "filters" %>
    <% end %>
  </div>

  <!-- ---------- Exercises list ----------- -->
  <div id="exercises" class="mt-8 grid gap-4 sm:gap-5">
    <% if @exercises.any? %>
      <% @exercises.each do |exercise| %>
        <div class="bg-white rounded-2xl shadow-sm border border-yellow-100 p-5 flex flex-col sm:flex-row sm:items-center sm:justify-between gap-4">
          <!-- Left: content -->
          <div class="min-w-0">
            <div class="flex items-center gap-2 flex-wrap">
              <h2 class="text-lg font-extrabold text-yellow-900 truncate">
                <%= exercise.name %>
              </h2>

              <% if user_signed_in? %>
                <% if exercise.is_system_exercise %>
                  <span class="inline-flex items-center rounded-full bg-yellow-100 text-yellow-900 px-2.5 py-1 text-xs font-semibold">
                    System
                  </span>
                <% else %>
                  <span class="inline-flex items-center rounded-full bg-green-100 text-green-800 px-2.5 py-1 text-xs font-semibold">
                    Custom
                  </span>
                <% end %>
              <% end %>

              <span class="inline-flex items-center rounded-full bg-gray-100 text-gray-700 px-2.5 py-1 text-xs font-semibold">
                <%= exercise.muscle_group.to_s.humanize %>
              </span>
            </div>

            <% if exercise.description.present? %>
              <p class="mt-2 text-sm text-yellow-800 leading-relaxed">
                <%= truncate(exercise.description, length: 140) %>
              </p>
            <% else %>
              <p class="mt-2 text-sm text-gray-500 italic">No description</p>
            <% end %>
          </div>

          <!-- Right: actions -->
          <div class="flex flex-col sm:flex-row gap-2 sm:items-center sm:justify-end">
            <%= link_to "Show", exercise, class: "text-center rounded-lg px-4 py-2 bg-yellow-100 text-yellow-900 font-semibold hover:bg-yellow-200 transition cursor-pointer" %>

            <% if user_signed_in? && !exercise.is_system_exercise %>
              <%= link_to "Edit", edit_exercise_path(exercise), class: "text-center rounded-lg px-4 py-2 bg-gray-100 text-gray-800 font-semibold hover:bg-gray-200 transition cursor-pointer" %>
              <% items_count = exercise.exercise_plan_items.count %>
              <%= button_to "Delete", exercise, method: :delete, class: "text-center rounded-lg px-4 py-2 bg-red-600 text-white font-semibold hover:bg-red-500 transition cursor-pointer", data: { turbo_confirm: items_count.positive? ? "Deleting this exercise will also delete #{items_count} exercise plan item(s) that use it. Continue?" : "Are you sure?" } %>
            <% end %>
          </div>
        </div>
      <% end %>
    <% else %>
      <div class="text-center my-12">
        <p class="text-yellow-900 font-bold text-xl">No exercises found.</p>
        <p class="text-yellow-800 mt-2">Try changing filters or add a new one.</p>
      </div>
    <% end %>
  </div>

</div>
